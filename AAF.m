function out = AAF(in, targetFs, specwidth)
% 抗混叠滤波器
% targetFs：目标采样频率，用于确定滤波器的截止频率。
% specwidth：信号的频谱宽度。

% 示例：% Anti-aliasing filtering
% sps = 10;
% Rs = 510e9;
% Fs = 256e9;
% aaf_sig = AAF(ps_sig, Fs, Rs*sps);

l = length(in);
in = fftshift(fft(in));
df = (specwidth - targetFs) / 2;
dl = ceil(df / specwidth * l);  % ceil向正无穷舍入，最近的整数
aafcoeff = ones(l, 1);
aafcoeff(1:dl) = 0; % 开头dl个数设置为0
aafcoeff(end-dl+1:end) = 0;  % 结尾前dl个数设置为0
out = ifft(ifftshift(in.*aafcoeff));

end


% 抗混叠滤波器的作用:满足采样率小于波特率情况下的，减小频谱混叠的情况

% 抗混叠滤波器通常是一个低通滤波器，在采样之前，将信号中高于奈奎斯特频率的成分滤除，使经过滤波后的信号最高频率满足奈奎斯特采样定理的要求。具体如下：
% 避免混叠：如果信号的波特率较高，其频谱可能包含高于奈奎斯特频率的成分。
% 抗混叠滤波器通过衰减这些高频成分，保证采样过程不会出现混叠。
% 例如，在一个通信系统中，信号的波特率对应的最高频率为 10 MHz，而采样频率为 15 MHz，此时奈奎斯特频率为 7.5 MHz。使用抗混叠滤波器将高于 7.5 MHz 的频率成分滤除，从而避免混叠。
% 提高采样质量：即使信号本身的最高频率没有超过奈奎斯特频率，但在实际环境中，信号可能会受到各种高频噪声的干扰。抗混叠滤波器可以将这些高频噪声滤除，提高采样信号的质量，使得后续的信号处理更加准确可靠。
% 信号波特率与采样率的理想关系
% 在理想情况下，采样率应该足够高，以确保信号波特率对应的最高频率小于采样率的一半，这样可以直接避免混叠问题的产生。但在实际工程中，由于硬件成本、处理能力等因素的限制，采样率可能无法无限制地提高，此时抗混叠滤波器就显得尤为重要。它可以在有限的采样率下，尽可能地保证采样信号的质量，使系统能够正常工作。
% 综上所述，抗混叠滤波器的目的是防止信号波特率对应的最高频率超过采样率的一半，而不是用于处理信号波特率大于采样率的情况。在设计通信系统时，应尽量使采样率满足奈奎斯特采样定理，并结合抗混叠滤波器来保证信号采样的准确性。